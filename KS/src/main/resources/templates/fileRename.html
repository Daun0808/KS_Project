<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>파일 일괄 이름변환 + ZIP 다운로드</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
<h2>파일 이름 변환</h2>
<input type="file" id="fileInput" multiple />
<br><br>
<button onclick="processFiles()">파일 이름 변경</button>

<script>
    function moveLast3ToFrontWithUnderscore(fileName) {
        const dotIndex = fileName.lastIndexOf(".");
        if (dotIndex === -1 || dotIndex < 3) return null;

        const name = fileName.substring(0, dotIndex);
        const ext = fileName.substring(dotIndex);
        if (name.length < 3) return null;

        const last3 = name.slice(-3);
        const remaining = name.slice(0, -3);
        return `${last3}_${remaining}${ext}`;
    }

    async function processFiles() {
        const input = document.getElementById('fileInput');
        const files = input.files;

        if (!files.length) {
            alert('파일을 선택해주세요.');
            return;
        }

        const zip = new JSZip();

        for (let file of files) {
            const newFileName = moveLast3ToFrontWithUnderscore(file.name);
            if (!newFileName) continue;

            const arrayBuffer = await file.arrayBuffer();
            zip.file(newFileName, arrayBuffer);
        }

        // ZIP 생성 후 다운로드
        zip.generateAsync({ type: "blob" }).then(function (content) {
            const link = document.createElement("a");
            link.href = URL.createObjectURL(content);
            link.download = "변환된_파일.zip";
            link.click();
            URL.revokeObjectURL(link.href);
        });
    }
</script>
</body>
</html>
